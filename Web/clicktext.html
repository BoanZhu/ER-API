<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type = "text/javascript" src="js/jquery-3.2.1.js"></script>
</head>
<body>
<a onclick="showEntityForm()">Show the entity form</a><br>
<a onclick="showRelationForm()">Show the relation form</a>
<form id="formRelation" style="display: none;">
    <div class = board_form style="border: 1px solid black;
                                    height: fit-content;
                                    width:500px;
                                    text-align: center;
                                    position:absolute;
                                    left: 50%;
	                                top: 50%;
	                                reverse: translate(-50%,-50%);">
    <p>relationship</p>
    <div id="relationInput" class = "relationInput"></div>
    <button id="relationAdder" type="button" class="btn btn-dark"><span></span>ADD</button>
    <button id="addRelation" type="button" class="btn btn-dark"><span></span>CREATE</button>
    </div>
</form>
<form id="formEntity" style="display: none;">
    <div class = board_form style="border: 1px solid black; min-height:100%; width:500px;text-align: center;">
        <div id="entity" class = "entity">
            <div class="entityName"><p>entity name</p><input id = "ename" type="text" class="attribute"></div>
            <p>attributes</p>
            <div id="newInput" class = "newInput"></div>
            <button id="rowAdder" type="button" class="btn btn-dark"><span></span>ADD</button>
            <button id="addEntity" type="button" class="btn btn-dark"><span></span>CREATE</button>
        </div>
    </div>
</form>
</body>
<script type="text/javascript">
    function showEntityForm() {
        document.getElementById('formEntity').style.display = 'block';
    }
    function showRelationForm() {
        document.getElementById('formRelation').style.display = 'block';
    }

    /*
    entity form
     */
    $("#rowAdder").click(function () {
        newRowAdd =
            '<div class="newInput"><div class="attribute" id = "attribute">' +
            '<button class="btn btn-danger" id="DeleteRow" type="button">Delete</button>'+
            '<input type="text" class="attribute_input"></input>'+
            '<input type="radio" class = "r" name = "primaryKey" id="key">is_key</input></div>'+'</div></div>';
        $('#newInput').append(newRowAdd);
    });

    $("body").on("click", "#DeleteRow", function () {
        $(this).parents("#attribute").remove();
    });

    $("body").on("click", "#addEntity", function () {
        const entity = {};
        const key = document.getElementById("ename").value;
        let items = [{ name: "ProductID", iskey: true, figure: "Decision", color:"red"}];
        items = [];
        entity.key = key;

        $(".attribute").each(function (){
            let attribute_dict = {};
            let attribute_name = "";
            //TODO:not allow if entity is empty
            attribute_name = $(this).children(".attribute_input").val();

            if (attribute_name !== undefined) {
                //TODO:not allow if attribute is empty
                console.log(attribute_name); //test. TODO:delete
                attribute_dict.name = attribute_name;
                let is_primaryKey =  true;
                is_primaryKey = $('#r').is(':checked') ? true : false;
                console.log(is_primaryKey);

                if (is_primaryKey==1){
                    attribute_dict.iskey = true;
                    attribute_dict.figure = "TriangleUp";
                    attribute_dict.color = "red";
                }else{
                    attribute_dict.iskey = false;
                    attribute_dict.figure = "Decision";
                    attribute_dict.color = "blue"
                }
                items.push(attribute_dict);
            }
            entity.items = items;
        });
        console.log(entity);

    });

    /*
    relationship form
     */

    $("#relationAdder").click(function () {
        newRowAdd =
            '<div class="relationInput"><div class="relation" id = "relation">' +
            '<input type="text" class="from"></input><br>'+
            '<input type="text" class="to"></input><br>'+
            '<input type="text" class="fromtext"></input><br>'+
            '<input type="text" class="toText"></input><br>'+
            '<button class="btn btn-danger" id="DeleteRow" type="button">Delete</button></div></div>';
        $('#relationInput').append(newRowAdd);
    });

    $("body").on("click", "#DeleteRow", function () {
        $(this).parents("#relation").remove();
    });

    $("body").on("click", "#addRelation", function () {
        let linkDataArray = [{from: "Products", to:"Suppliers",text: "0..N",toText: "1" }];
        linkDataArray = [];

        $(".relation").each(function (){
            /*
            initialize the attribute dict
             */
            let relation_dict = {};
            let from = "";
            let to = "";
            let fromtext= "";
            let toText=""

            from = $(this).children(".from").val();
            to = $(this).children(".to").val();
            fromtext = $(this).children(".fromtext").val();
            toText = $(this).children(".toText").val();

            if ((from !== undefined)) {
                relation_dict.from = from;
                relation_dict.to = to;
                relation_dict.fromtext = fromtext;
                relation_dict.toText = toText;

                linkDataArray.push(relation_dict);
            }
        });
        console.log(linkDataArray);
    });

</script>
</html>